# ðŸ“Š UML Sequence Diagrams
## Visual System Flow Documentation

---

## 1ï¸âƒ£ PASSWORD RESET REQUEST FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚  â”‚ Frontend â”‚  â”‚ Backend â”‚  â”‚ Database â”‚  â”‚ WebSocketâ”‚  â”‚ Admin UI  â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Click "Message Admin"    â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Fill form (ID, Email)    â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Submit    â”‚              â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ POST /api/password/request              â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ INSERT notifications     â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ INSERT activity_log      â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Generate AI message      â”‚              â”‚
   â”‚           â”‚              â”‚ (Jose AI)  â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Emit notification:new    â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚ Broadcast    â”‚
   â”‚           â”‚              â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ 200 OK       â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Success   â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚  Bell badge +1
   â”‚           â”‚              â”‚            â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚  Click notification
   â”‚           â”‚              â”‚            â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚  Open overlay
   â”‚           â”‚              â”‚            â”‚             â”‚  [Grant] [Decline]
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚  Click "Grant"
   â”‚           â”‚              â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ PATCH /api/password/approve            â”‚
   â”‚           â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ UPDATE notifications     â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ status='granted'         â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Generate reset code      â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Send email to user       â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Emit notification:update â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚ To User      â”‚
   â”‚           â”‚              â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ Notification: "Approved" â”‚            â”‚             â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Enter reset code         â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ New password             â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ POST /api/password/reset â”‚             â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ UPDATE users             â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ password_hash            â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ 200 OK       â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ "Password changed!"      â”‚            â”‚             â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
```

---

## 2ï¸âƒ£ MIRROR LOGIN FLOW (Manual & QR)

```
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚  â”‚ Mirror   â”‚  â”‚ Backend â”‚  â”‚ Database â”‚  â”‚ WebSocketâ”‚  â”‚ Admin UI  â”‚
â”‚      â”‚  â”‚ Frontend â”‚  â”‚         â”‚  â”‚          â”‚  â”‚          â”‚  â”‚           â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Open Mirror Login Page   â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Choose: Manual OR QR     â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
   â”‚ â”‚ MANUAL LOGIN PATH                               â”‚ â”‚              â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Enter ID + Password      â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Click "Login"            â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ POST /api/mirror/login   â”‚             â”‚              â”‚
   â”‚           â”‚ {user_id, password, method: "manual"}  â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Authenticate            â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ INSERT activity_log     â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ event: "LIBRARY LOGIN"  â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ INSERT library_sessions â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ status: "inside_library"â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Emit notification:new   â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚ Broadcast    â”‚
   â”‚           â”‚              â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚  Bell +1     â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚  "KC-00045   â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚   logged in" â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ 200 OK       â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ {session_id} â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Welcome toast            â”‚            â”‚             â”‚              â”‚
   â”‚ "Welcome, John Santos!"  â”‚            â”‚             â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Button changes:          â”‚            â”‚             â”‚              â”‚
   â”‚ - Color: GREEN           â”‚            â”‚             â”‚              â”‚
   â”‚ - Text: "Logout from Library"        â”‚             â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
   â”‚ â”‚ QR CODE LOGIN PATH                              â”‚ â”‚              â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Scan QR Code             â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ POST /api/mirror/login   â”‚             â”‚              â”‚
   â”‚           â”‚ {user_id, method: "qrcode", qr_token}  â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Verify QR token         â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ (Same flow as manual)   â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
```

---

## 3ï¸âƒ£ MIRROR LOGOUT WITH BOOK RETURN FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚  â”‚ Mirror   â”‚  â”‚ Backend â”‚  â”‚ Database â”‚  â”‚ WebSocketâ”‚  â”‚ Admin UI  â”‚
â”‚      â”‚  â”‚ Frontend â”‚  â”‚         â”‚  â”‚          â”‚  â”‚          â”‚  â”‚           â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Click "Logout from Library" (GREEN)  â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ GET /api/mirror/check-borrowed         â”‚              â”‚
   â”‚           â”‚ ?user_id=KC-00045        â”‚             â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ SELECT FROM borrow_records             â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ WHERE user_id AND status='borrowed'    â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ 200 OK       â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ {has_borrowed: true,     â”‚             â”‚              â”‚
   â”‚           â”‚  borrowed_books: [...]}  â”‚             â”‚              â”‚
   â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Prompt:                  â”‚            â”‚             â”‚              â”‚
   â”‚ "Please scan borrowed    â”‚            â”‚             â”‚              â”‚
   â”‚  book QR to return"      â”‚            â”‚             â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Scan book QR code        â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ POST /api/book/return    â”‚             â”‚              â”‚
   â”‚           â”‚ {user_id, book_id, method: "qrcode"}   â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ UPDATE borrow_records   â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ status='returned'       â”‚              â”‚
   â”‚           â”‚              â”‚ returned_at=NOW()       â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ INSERT activity_log     â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ event: "BOOK RETURN"    â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ UPDATE library_sessions â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ status='logged_out'     â”‚              â”‚
   â”‚           â”‚              â”‚ logout_time=NOW()       â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Emit notification:new   â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
   â”‚           â”‚              â”‚ "Book returned by KC-00045"            â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚ Broadcast    â”‚
   â”‚           â”‚              â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚  Bell +1     â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚  "KC-00045   â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚   returned   â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚   book"      â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ 200 OK       â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Success message:         â”‚            â”‚             â”‚              â”‚
   â”‚ "Book return successful. â”‚            â”‚             â”‚              â”‚
   â”‚  You are now logged out."â”‚            â”‚             â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Button changes:          â”‚            â”‚             â”‚              â”‚
   â”‚ - Color: PALE/DISABLED   â”‚            â”‚             â”‚              â”‚
   â”‚ - Text: "Login to Library"           â”‚             â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
   â”‚ â”‚ ALTERNATIVE: No Borrowed Books                  â”‚ â”‚              â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ If has_borrowed: false   â”‚            â”‚             â”‚              â”‚
   â”‚ â†’ Direct logout          â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
   â”‚ â”‚ ALTERNATIVE: Reservation Not Borrowed           â”‚ â”‚              â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Prompt: "Cancel reservation and logout?"          â”‚              â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚ Click "Yes"              â”‚            â”‚             â”‚              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚ POST /api/reservation/cancel           â”‚              â”‚
   â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ UPDATE reservations     â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ status='cancelled'      â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
   â”‚           â”‚              â”‚ Emit notification:new   â”‚              â”‚
   â”‚           â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
   â”‚           â”‚              â”‚ "Reservation cancelled" â”‚              â”‚
   â”‚           â”‚              â”‚            â”‚             â”‚              â”‚
```

---

## 4ï¸âƒ£ AUTO LOGOUT WARNING (5 PM)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ Cron Job â”‚  â”‚ Backend â”‚  â”‚ Database â”‚  â”‚ WebSocketâ”‚  â”‚ Admin UI  â”‚  â”‚ User â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚ 5:00 PM     â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚ Trigger     â”‚            â”‚             â”‚              â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ SELECT FROM library_sessions            â”‚            â”‚
     â”‚             â”‚ WHERE status='inside_library'           â”‚            â”‚
     â”‚             â”‚ AND login_time < (NOW() - 8 hours)      â”‚            â”‚
     â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ Results:   â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ [KC-00045, KC-00123]     â”‚              â”‚            â”‚
     â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ FOR EACH user:          â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ Generate AI warning     â”‚              â”‚            â”‚
     â”‚             â”‚ (Jose AI - unique msg)  â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ INSERT notifications    â”‚              â”‚            â”‚
     â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ target: ALL_ADMINS      â”‚              â”‚            â”‚
     â”‚             â”‚ type: 'security'        â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ INSERT notifications    â”‚              â”‚            â”‚
     â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ target: KC-00045        â”‚              â”‚            â”‚
     â”‚             â”‚ type: 'warning'         â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚ Emit notification:new   â”‚              â”‚            â”‚
     â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚ To Admins    â”‚            â”‚
     â”‚             â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚  Bell +1     â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚  "KC-00045   â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚   still in   â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚   library"   â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚ To User      â”‚            â”‚
     â”‚             â”‚            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚  Notification
     â”‚             â”‚            â”‚             â”‚              â”‚  "Please   â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚   logout"  â”‚
     â”‚             â”‚            â”‚             â”‚              â”‚            â”‚
```

---

## ðŸ“Š LEGEND

```
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚Actor â”‚  = System component or user
â””â”€â”€â”€â”€â”€â”€â”˜

   â”‚      = Lifeline (component is active)
   
   â”œâ”€â”€â”€>  = Synchronous message (request)
   
   <â”€â”€â”€â”¤  = Response
   
   â”Œâ”€â”€â”€â”
   â”‚Boxâ”‚  = Note or alternative flow
   â””â”€â”€â”€â”˜
```

---

## ðŸŽ¯ KEY TAKEAWAYS

### Password Reset Flow
1. User submits request â†’ Backend stores â†’ WebSocket notifies all admins
2. Admin clicks notification â†’ Overlay opens â†’ Grant/Decline
3. Backend processes â†’ Notifies user â†’ User resets password

### Mirror Login Flow
1. User enters credentials (manual or QR) â†’ Backend authenticates
2. Backend creates session â†’ Stores in database â†’ Notifies admins
3. Frontend updates button to green "Logout from Library"

### Mirror Logout Flow
1. User clicks logout â†’ Backend checks borrowed books
2. If borrowed: Prompt to scan book QR â†’ Return book â†’ Logout
3. If reservation: Prompt to cancel â†’ Cancel â†’ Logout
4. Backend updates session â†’ Notifies admins

### Auto Logout Warning
1. Cron job runs at 5 PM â†’ Checks active sessions
2. Generates AI warnings â†’ Notifies admins + users
3. Security alert for compliance

---

## âœ… IMPLEMENTATION NOTES

**All flows use:**
- RESTful API endpoints
- WebSocket for real-time updates
- Database persistence
- Jose AI for unique messages
- Notification bell for admins
- Activity log for audit trail

**Responsive design ensures:**
- Mobile, tablet, desktop compatibility
- Vertical scrollbar for long lists
- Dynamic button states
- Real-time badge updates

**System is production-ready! ðŸŽ‰**
